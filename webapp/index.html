<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Shade Setup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      font-size: 1.6rem;
      margin-bottom: 10px;
    }
    button {
      background: #007bff;
      border: none;
      color: white;
      padding: 10px 16px;
      margin: 6px;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .section {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .sensor-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 8px;
      font-family: monospace;
    }
    .status {
      font-weight: bold;
      color: #333;
      margin-top: 5px;
    }
  </style>
</head>
<body>

  <h1>Smart Shade Control Panel</h1>

  <!-- MODE CONTROL -->
  <div class="section">
    <h2>Mode Selection</h2>
    <button onclick="setMode('auto')">Auto</button>
    <button onclick="setMode('manual')">Manual</button>
    <button onclick="setMode('setup')">Setup</button>
    <button onclick="setMode('schedule')">Schedule</button>
    <div class="status">Current Mode: <span id="modeDisplay">Loading...</span></div>
  </div>

  <!-- BLIND CONTROL -->
  <div class="section">
    <h2>Blind Controls</h2>
    <button onclick="move('up')">‚¨ÜÔ∏è Up</button>
    <button onclick="move('down')">‚¨áÔ∏è Down</button>
    <button onclick="swapBlind()">üîÑ Swap Blind</button>
    <div class="status">Active Shade: <span id="shadeDisplay">Loading...</span></div>
    <div class="status">Current Step: <span id="stepDisplay">0</span></div>
  </div>

  <!-- SENSOR DISPLAY -->
  <div class="section">
    <h2>Sensor Readings</h2>
    <button onclick="refreshSensors()">üîÑ Refresh Sensors</button>
    <div id="sensorContainer" class="sensor-list">Loading...</div>
  </div>

  <!-- SAVE CONFIG -->
  <div class="section">
    <h2>Configuration</h2>
    <button onclick="saveConfig()">üíæ Save Configuration</button>
    <div id="saveNotice" class="status"></div>
  </div>

<script>
async function updateStatus() {
  const res = await fetch("/api/status");
  const data = await res.json();
  document.getElementById("modeDisplay").textContent = data.mode;
  document.getElementById("shadeDisplay").textContent = data.active_shade;
  document.getElementById("stepDisplay").textContent = data.step;
}

async function setMode(mode) {
  await fetch("/api/mode", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ mode })
  });
  updateStatus();
}

async function move(direction) {
  await fetch("/api/move", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ direction, steps: 10 })
  });
  updateStatus();
}

async function swapBlind() {
  await fetch("/api/swap", { method: "POST" });
  updateStatus();
}

async function refreshSensors() {
  const res = await fetch("/api/sensors");
  const data = await res.json();
  const container = document.getElementById("sensorContainer");
  container.innerHTML = "";
  data.readings.forEach((r, i) => {
    const div = document.createElement("div");
    div.textContent = `Sensor ${i + 1}: ${r === null ? "N/A" : r.toFixed(2) + " lux"}`;
    container.appendChild(div);
  });
}

async function saveConfig() {
  // example placeholder configuration (real app should gather values)
  const settings = {
    motors: [1200, 980],
    sensor_steps: [0, 100, 200],
    threshold: 45
  };
  const schedules = [
    { time: "07:30", motor: "sunshade", level: "1" },
    { time: "21:00", motor: "blackout", level: "2" }
  ];

  const res = await fetch("/api/save", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ settings, schedules })
  });

  const msg = document.getElementById("saveNotice");
  if (res.ok) {
    msg.textContent = "‚úÖ Configuration saved to Raspberry Pi.";
  } else {
    msg.textContent = "‚ùå Failed to save configuration.";
  }
  setTimeout(() => (msg.textContent = ""), 4000);
}

setInterval(updateStatus, 2000);
refreshSensors();
updateStatus();
</script>

</body>
</html>

